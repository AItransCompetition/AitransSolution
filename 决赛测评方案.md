# 决赛测评方案

- 决赛阶段：9月2至9月21日，共计3次提交机会（提交系统开放后会另行通知），选手需使用官方发布的带DTP发包器的docker镜像和初赛训练集进行本地训练，选手需要把初赛的算法内容迁移至决赛系统所能接受的形式，并在docker环境中进行调试训练，建议选手使用[官方教程](https://github.com/TOPbuaa/AitransSolution/blob/tc_tool/README.md#%E5%86%B3%E8%B5%9B%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8)来本地搭建实验环境。
- 测评阶段：9月21日至9月25日（共5日），将选手代码应用于docker环境和真实网络场景进行测评。

## solution

### 启发式算法

选手只需要将初赛所写的python代码，转写成c++代码即可。

我们已经对初赛所提供的reno demo进行了决赛系统的转写，可以参照[决赛系统-reno demo](https://github.com/TOPbuaa/AitransSolution/tree/tc_tool/src/aitrans/reno)。

### 与python代码的交互

部分选手对python的一些语法特性、库具有依赖（dict、numpy等等）,为此我们提供了关于C++与python交互的一些使用案例，可以参照[决赛算法与python的交互](https://github.com/TOPbuaa/AitransSolution/tree/tc_tool/src/aitrans/call_python)

### AI算法

选手应在本地使用所提供的docker决赛系统和训练集进行训练，并使用深度学习框架所提供的[ONNX](https://zh.wikipedia.org/wiki/ONNX)（Open Neural Network Exchange，开放式网络交换）模型导出API，及时导出ONNX模型，选手所提交的算法应包括原始数据适应网络输入的处理、调用onnx模型进行决策等等，但不应该进行在线训练。

具体模型导出方法以及C++调用方法可以参照[pytorch官方文档](https://pytorch.org/tutorials/advanced/cpp_export.html)

## 决赛测评阶段

将选手算法部署置docker环境以及真实系统，使用决赛阶段最新代码进行测评，无提交机会。

### docker跑分

与初赛跑分方案一致，每日使用与当日训练集对应的测试集进行测评，取最高分为当日成绩。

### 真实系统

将选手算法应用于由合作公司提供真实的网络传输环境，并进行测评，取最高分为当日成绩。

# 与初赛系统的差异

- 决赛系统使用的是quiche的重传机制;
- 决赛系统能为选手算法提供的输入的方式和内容的差异，详情参见输入；
- 决赛系统提供的demo中，选手需要完成函数SolutionInit、SolutionSelectBlock和SolutionCcTrigger函数的实现，且这3个函数分别对应初赛Solution类中的\_\_init\_\_、select_packet和append_cc_input函数；
- 在调度2（拥塞控制）中，选手算法处理的事件是从上一次调度开始未处理的所有事件，这就意味着在选手未作出反馈（更新cwnd或rate）时，系统默认使用上一次调度反馈的参数进行运转，选手算法本次运行时间越长，积留给下次调度的事件数量也就越多。

# 输入

| 变量名            | 含义                                     | 初赛对应量        |
| ----------------- | ---------------------------------------- | ----------------- |
| blocks            | 当前可发的block组成的信息                | packet_queue      |
| block_num         | blocks链表长度                           | len(packet_queue) |
| current_time      | 当前时间（ms）                           | cur_time          |
| cc_infos          | 当前时刻还未处理的拥塞控制相关的一些信息 |                   |
| cc_num            | cc_infos链表的长度                       |                   |
| pacing_rate       | 发送速率（bit /s）                       | send_rate         |
| congestion_window | 拥塞窗口大小（Bytes）                    | cwnd              |

## 输入-blocks


| 变量名            | 含义                 | 初赛对应量                |
| ----------------- | -------------------- | ------------------------- |
| block_id          | 当前block的ID        | block_info -- Block_id    |
| block_deadline    | deadline（ms）       | block_info -- Deadline    |
| block_priority    | 优先级               | block_info -- Priority    |
| block_create_time | 创建时间（ms）       | block_info -- Create_time |
| block_size        | block总大小（Bytes） | block_info -- Size        |

## 输入-cc_infos

| 变量名          | 含义                                      | 初赛对应量                                           |
| --------------- | ----------------------------------------- | ---------------------------------------------------- |
| event_type      | 取值'D'和'F'，分别表示丢包事件和ack包事件 | data -- event_type                                   |
| rtt             | 往返时延（ms）                            | data -- packet_information_dict -- Latency           |
| bytes_in_flight | 发送端已发出但未收到反馈的字节数（Bytes） | data -- packet_information_dict -- Extra -- inflight |

------

